# Email Templates Quick Reference

## Available Templates

### 1. ðŸ“§ Email Verification
**File:** `functions/email_functions.js` - `emailTemplates.verification()`

**When sent:** Automatically when user signs up with email/password

**Design:**
- Purple gradient header with CrowdWave logo
- Personalized greeting with user's display name
- Large green "Verify Email Address" button
- Clickable fallback link
- Security warning box (yellow)
- 1-hour expiration notice

**Customization points:**
- `displayName` - User's name
- `verificationLink` - Generated by Firebase Auth

**Example:**
```javascript
const template = emailTemplates.verification('John Doe', 'https://...');
```

---

### 2. ðŸ” Password Reset
**File:** `functions/email_functions.js` - `emailTemplates.passwordReset()`

**When sent:** Via Cloud Function call when user requests password reset

**Design:**
- Purple gradient header with CrowdWave logo
- Red-themed "Reset Your Password" button
- Security notice box (yellow)
- Password strength tips box (blue)
- Clickable fallback link

**Customization points:**
- `displayName` - User's name (optional)
- `resetLink` - Generated by Firebase Auth

**Example:**
```javascript
const template = emailTemplates.passwordReset('Jane Smith', 'https://...');
```

---

### 3. ðŸ“¦ Delivery Update
**File:** `functions/email_functions.js` - `emailTemplates.deliveryUpdate()`

**When sent:** Via Cloud Function when package status changes

**Design:**
- Purple gradient header with CrowdWave logo
- Status badge (green background)
- Package details card with:
  - Tracking number
  - Origin (from)
  - Destination (to)
  - Estimated delivery date
- Purple "Track Your Package" button

**Customization points:**
- `packageDetails.trackingNumber`
- `packageDetails.from`
- `packageDetails.to`
- `packageDetails.estimatedDelivery`
- `status` - Current status
- `trackingUrl` - Link to tracking page

**Example:**
```javascript
const template = emailTemplates.deliveryUpdate(
  {
    trackingNumber: 'CW-12345',
    from: 'Berlin, Germany',
    to: 'Paris, France',
    estimatedDelivery: '2025-10-25'
  },
  'In Transit',
  'https://crowdwave.eu/track/CW-12345'
);
```

---

## Common Design Elements

### Color Scheme
- **Primary Gradient:** `#667eea` â†’ `#764ba2` (Purple)
- **Success/Verify:** `#4caf50` (Green)
- **Warning:** `#ffc107` (Yellow)
- **Danger/Reset:** `#ff6b6b` â†’ `#ee5a6f` (Red)
- **Info:** `#2196F3` (Blue)

### Typography
- **Font Family:** `-apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif`
- **Logo Size:** 32px, bold
- **Title Size:** 24px, semi-bold
- **Body Text:** 16px, line-height 24px
- **Small Text:** 14px

### Layout
- **Max Width:** 600px
- **Border Radius:** 8px (cards), 6px (buttons), 20px (badges)
- **Padding:** 40px (sections), 30px (footer)
- **Shadow:** `0 2px 8px rgba(0,0,0,0.1)`

### Buttons
- **Padding:** 16px 40px
- **Font Size:** 16px, semi-bold
- **Hover Effect:** `translateY(-2px)`
- **Gradient Background:** Matching theme color

---

## Adding New Templates

### Step 1: Define Template
Add to `emailTemplates` object in `functions/email_functions.js`:

```javascript
newTemplate: (param1, param2) => ({
  subject: 'Email Subject Here',
  html: `
    <!DOCTYPE html>
    <html>
    <!-- Your HTML here -->
    </html>
  `,
  text: `
    Plain text version here
  `,
}),
```

### Step 2: Create Cloud Function
Add function to `functions/email_functions.js`:

```javascript
exports.sendNewTemplate = functions.https.onCall(async (data, context) => {
  const { recipientEmail, param1, param2 } = data;
  
  const transporter = getEmailTransporter();
  const template = emailTemplates.newTemplate(param1, param2);
  
  await transporter.sendMail({
    from: '"CrowdWave" <nauman@crowdwave.eu>',
    to: recipientEmail,
    subject: template.subject,
    text: template.text,
    html: template.html,
  });
  
  return { success: true };
});
```

### Step 3: Export Function
Add to bottom of `functions/email_functions.js`:

```javascript
module.exports = {
  // ... existing exports
  sendNewTemplate: exports.sendNewTemplate,
};
```

### Step 4: Import in index.js
Add to `functions/index.js`:

```javascript
exports.sendNewTemplate = emailFunctions.sendNewTemplate;
```

### Step 5: Create Flutter Service Method
Add to `lib/services/custom_email_service.dart`:

```dart
Future<bool> sendNewTemplate({
  required String recipientEmail,
  required String param1,
  required String param2,
}) async {
  try {
    final result = await _functions
        .httpsCallable('sendNewTemplate')
        .call({
      'recipientEmail': recipientEmail,
      'param1': param1,
      'param2': param2,
    });
    return result.data['success'] == true;
  } catch (e) {
    throw Exception('Failed to send email');
  }
}
```

---

## Testing Templates

### Using Email Test Screen
1. Open app â†’ Debug menu â†’ Email Testing
2. Toggle "Use Cloud Function" ON
3. Enter test email address
4. Click appropriate test button
5. Check email inbox (and spam)

### Manual Testing with Cloud Functions
```bash
# Test from Firebase Console
# Go to Functions â†’ Select function â†’ Testing tab
# Send test data
```

### Testing HTML Locally
1. Copy HTML from template
2. Save as `.html` file
3. Open in browser to preview
4. Test in multiple email clients:
   - Gmail
   - Outlook
   - Apple Mail
   - Mobile clients

---

## Email Client Compatibility

### Tested and Working
- âœ… Gmail (Web, Android, iOS)
- âœ… Outlook (Web, Desktop)
- âœ… Apple Mail (macOS, iOS)
- âœ… Yahoo Mail
- âœ… ProtonMail

### Known Issues
- Some corporate email servers strip CSS
- Very old email clients may show plain text
- Dark mode may affect colors

### Best Practices
- Always include text version
- Use inline CSS (we do this)
- Test in multiple clients
- Keep design simple
- Use web-safe fonts

---

## Localization (Future)

To add multi-language support:

1. Create translation files
2. Pass `language` parameter to template functions
3. Use translation keys in templates
4. Load appropriate translations based on user language

Example:
```javascript
verification: (displayName, verificationLink, language = 'en') => {
  const translations = {
    en: { subject: 'Verify your email', ... },
    de: { subject: 'BestÃ¤tigen Sie Ihre E-Mail', ... },
  };
  const t = translations[language];
  // Use t.subject, etc.
}
```

---

## Performance Tips

1. **Image Optimization:**
   - Use emoji instead of images (ðŸŒŠ not logo.png)
   - If using images, host on CDN
   - Optimize image size

2. **Email Size:**
   - Keep under 102KB for best delivery
   - Minify HTML for production
   - Remove unused CSS

3. **Sending Speed:**
   - Batch emails when possible
   - Use background functions
   - Implement queue system for high volume

---

## Monitoring and Analytics

### Check Email Delivery
```bash
firebase functions:log --only sendPasswordResetEmail
```

### Track Metrics
- Emails sent (count)
- Delivery success rate
- Open rate (requires tracking pixels)
- Click rate (requires tracked links)

### Error Handling
All functions include comprehensive error logging:
- SMTP errors
- Firebase errors
- Invalid data errors
- Rate limit errors

Check logs:
```bash
firebase functions:log
```

---

## Support Contacts

**General Support:** support@crowdwave.eu
**Security Issues:** security@crowdwave.eu
**Technical Issues:** Check Firebase Functions logs

---

## Resources

- [Nodemailer Documentation](https://nodemailer.com/)
- [Email on Acid](https://www.emailonacid.com/) - Email testing
- [Can I Email](https://www.caniemail.com/) - CSS support checker
- [HTML Email Templates](https://htmlemail.io/) - More examples
